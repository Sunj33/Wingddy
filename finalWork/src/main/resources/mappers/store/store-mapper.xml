<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="storeMapper">
	<resultMap type="Store" id="storeResultSet">
		<result column="SP_NO" property="spNo"/>
		<result column="FILE_NO" property="fileNo"/>
		<result column="SP_NAME" property="spName"/>
		<result column="SP_CONTENT" property="spCount"/>
		<result column="SP_PRICE" property="spPrice"/>
		<result column="AMOUNT" property="amount"/>
		<result column="VIEW_COUNT" property="viewCount"/>
		<result column="SP_ONECOM" property="spOnecom"/>
		<result column="SP_DAY" property="spDay"/>
	</resultMap>
	<resultMap type="Attachment" id="AttachmentResultSet">
		<result column="FILE_NO" property="fileNo"/>
		<result column="MEMBER_NO" property="memNo"/>
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_LEVEL" property="fileLevel"/>
		<result column="FILE_PATH" property="filePath"/>
	
	</resultMap>
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*) FROM S_STORE
	</select>
	<select id="selectList" resultMap="storeResultSet,AttachmentResultSet">
			SELECT 
			    S.SP_NAME
			    ,S.SP_PRICE
			    ,S.VIEW_COUNT
			    ,S.SP_DAY   
			    ,A.FILE_NO
			    ,A.FILE_LEVEL
			FROM S_STORE S
			JOIN ATTACHMENT A  ON (S.FILE_NO= A.FILE_NO)
			WHERE A.FILE_LEVEL = 2
			AND AMOUNT > 0
			ORDER BY SP_DAY ASC
		<!--CK확인후 수정요망  -->
	</select>
	<insert id="insertStoreBoard" parameterType="list">
	INSERT 
				ALL
		INTO	
				ATTACHMENT
				(FILE_NO
				,MEMBER_NO
				,ORIGIN_NAME
				,CHANGE_NAME
				,FILE_LEVEL)
		VALUES
				(SEQ_FNO.NEXTVAL
				,1 <!-- ,#{loginUser.memberNo} -->
				,#{upfile.originalFilename}
				,#{at.changeName}
				,2)
	
		INTO
				S_STORE
				(SP_NO
				 ,FILE_NO
				,SP_NAME
				,SP_CONTENT
				,SP_PRICE
				,AMOUNT
				,SP_ONECOM
				,SP_DAY)
		VALUES
			(SEQ_SP_NO.NEXTVAL
			,SEQ_FNO.NEXTVAL 
			,#{spName}
			,#{spContent}
			,#{spPrice}
			,#{amount}
			,#{spOnecom}
			,SYSDATE)	
		SELECT * FROM DUAL
	</insert>
</mapper>